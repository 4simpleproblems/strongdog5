var u=(t,e,s)=>new Promise((l,r)=>{var i=o=>{try{a(s.next(o))}catch(c){r(c)}},n=o=>{try{a(s.throw(o))}catch(c){r(c)}},a=o=>o.done?l(o.value):Promise.resolve(o.value).then(i,n);a((s=s.apply(t,e)).next())});import{bE as h,u as m,b0 as S,b2 as d,U as y,A as W}from"./index-BszMCtG6.js";const f=[{name:"AKM",keyPosition:1,isGiftWeapon:!1},{name:"AWM",keyPosition:2,isGiftWeapon:!1},{name:"Mossberg",keyPosition:3,isGiftWeapon:!1},{name:"HK MG5",keyPosition:4,isGiftWeapon:!0},{name:"MP5",keyPosition:5,isGiftWeapon:!0},{name:"SCAR",keyPosition:6,isGiftWeapon:!0},{name:"VSS Vintorez",keyPosition:7,isGiftWeapon:!0},{name:"Crossbow",keyPosition:8,isGiftWeapon:!0}],p=Object.fromEntries(f.map(t=>[t.keyPosition,t]));Object.fromEntries(f.map(t=>[t.name,t]));const O=h("loadout",{state:()=>({currentSelection:null,maxDisplaySlots:8}),getters:{selectedWeaponName(){return this.currentSelection},getOwnedWeaponNames(){const t=m();return new Set(t.inventory.filter(e=>e.type==="0").map(e=>e.name))},displayLoadouts(){const t=m(),e=[];t.loadouts.forEach((n,a)=>{if(n.weapon1){const o=t.inventory.find(c=>c.inventoryItemId===n.weapon1);if(!o)throw new Error(`In-game loadout: Weapon ${n.weapon1} not found in inventory`);e.push({position:a+1,weapon:o,type:"permanent",keyBinding:(a+1).toString(),isSelected:this.currentSelection===o.name,loadoutIndex:a})}});const s=e.length,l=8,r=this.getOwnedWeaponNames,i=Object.values(p).filter(n=>n&&n.isGiftWeapon&&!r.has(n.name));for(let n=0;n<Math.min(i.length,l-s);n++){const a=i[n],o=s+n+1;e.push({position:o,weapon:{name:a.name,availableSkins:[{name:a.name}]},type:"locked",keyBinding:o.toString(),isSelected:this.currentSelection===a.name,loadoutIndex:null})}for(;e.length<l;){const n=e.length+1;e.push({position:n,weapon:null,type:"locked",keyBinding:n.toString(),isSelected:!1,loadoutIndex:null})}return e}},actions:{selectWeapon(t){this.currentSelection=t,this.sendSelectionToServer()},selectByPosition(t){const e=p[t];e&&this.selectWeapon(e.name)},clearSelection(){this.currentSelection=null},startNewSession(){this.currentSelection=null},sendSelectionToServerByIndex(t){var r,i,n;const e=S(),s=(r=e.gameWorld)==null?void 0:r.server;if(!s)return;!((n=(i=e.gameWorld)==null?void 0:i.player)!=null&&n.hasSpawnedOnce)?s.ws.sendDataImmediately([d.SET_LOADOUT,t]):s.sendMessage(d.SET_LOADOUT,t)},sendSelectionToServer(){var i,n,a;if(!this.currentSelection)return;const t=m(),e=S(),s=(i=e.gameWorld)==null?void 0:i.server;if(!s)return;const l=t.loadouts.findIndex(o=>{var c;return((c=o.weapon1)==null?void 0:c.name)===this.currentSelection}),r=!((a=(n=e.gameWorld)==null?void 0:n.player)!=null&&a.hasSpawnedOnce);l>=0?this.sendSelectionToServerByIndex(l):r?(s.ws.sendDataImmediately([d.ADD_FREE_LOADOUT,this.currentSelection]),setTimeout(()=>{var o;(o=e.gameWorld)!=null&&o.server&&e.gameWorld.server.ws.sendDataImmediately([d.SET_LOADOUT,this.currentSelection])},100)):(s.sendMessage(d.ADD_FREE_LOADOUT,this.currentSelection),setTimeout(()=>{var o;(o=e.gameWorld)!=null&&o.server&&s.sendMessage(d.SET_LOADOUT,this.currentSelection)},100))},handleKeyPress(t){return u(this,null,function*(){var i,n;const e=parseInt(t);if(isNaN(e)||e<1||e>8)return;const s=S();if(!(s.loadoutsLayout||!((n=(i=s.gameWorld)==null?void 0:i.player)!=null&&n.hasSpawnedOnce)))return;const r=this.displayLoadouts.find(a=>a.position===e);r&&(yield this.handleLoadoutSelection(r))})},handleLoadoutClick(t){return u(this,null,function*(){yield this.handleLoadoutSelection(t)})},handleLoadoutSelection(t){return u(this,null,function*(){!t||!t.weapon||(t.type==="permanent"?(this.selectWeaponByIndex(t.loadoutIndex,t.weapon.name),this.closeLoadoutWindow(!0)):t.type==="locked"&&(yield y().giftLoadout(),this.selectWeapon(t.weapon.name),this.closeLoadoutWindow(!0)))})},selectWeaponByIndex(t,e){this.currentSelection=e,this.sendSelectionToServerByIndex(t)},closeLoadoutWindow(t=!1){var i;const e=S(),s=W(),l=e.gameWorld&&!e.gameWorld.player.hasSpawnedOnce,r=e.deathScreen!==null;if(l&&!this.currentSelection){const n=this.displayLoadouts.find(a=>a.type==="permanent");n&&n.weapon&&this.selectWeaponByIndex(n.loadoutIndex,n.weapon.name)}if(e.loadoutsLayout=!1,r&&!l&&t&&e.gameWorld){e.gameWorld.requestRespawn();return}if(l&&e.gameWorld){e.gameWorld.requestRespawn();return}if(!s.isMobileOrTablet&&!l&&!r&&e.gameWorld){const o=(e.gameWorld.systemsManager.activeSystems||[]).find(c=>c.constructor.name==="PointerLockSystem");(i=o==null?void 0:o.lockWrapper)==null||i.call(o)}}}});export{O as u};
